<div class="flex flex-col gap-8">
  <!-- Controls: Search, Category, Sort -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
    <div class="relative md:col-span-1">
      <input 
        type="text" 
        placeholder="Search items..."
        (input)="onSearch($event)"
        [value]="store.searchTerm()"
        class="w-full pl-10 pr-4 py-3 bg-slate-highlight border border-slate-700 rounded-lg focus:ring-2 focus:ring-neon-mint focus:outline-none transition-shadow"
        aria-label="Search for an item"
      >
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-400"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
      </div>
    </div>
    <div>
      <select (change)="onCategoryChange($event)" [value]="store.selectedCategory()" class="bg-slate-highlight border border-slate-700 text-white text-sm rounded-lg focus:ring-neon-mint focus:border-neon-mint block w-full p-3 h-full" aria-label="Filter items by category">
        <option value="all">All Categories</option>
        @for(cat of store.allCategories(); track cat.name) {
          <option [value]="cat.name">{{ cat.name.replace('-', ' ') | titlecase }}</option>
        }
      </select>
    </div>
    <div>
      <select (change)="onSortChange($event)" [value]="store.sortOrder()" class="bg-slate-highlight border border-slate-700 text-white text-sm rounded-lg focus:ring-neon-mint focus:border-neon-mint block w-full p-3 h-full" aria-label="Sort items">
        <option value="name-asc">Sort by Name (A-Z)</option>
        <option value="name-desc">Sort by Name (Z-A)</option>
        <option value="cost-asc">Sort by Cost (Low-High)</option>
        <option value="cost-desc">Sort by Cost (High-Low)</option>
      </select>
    </div>
  </div>

  @if (store.loading() && store.paginatedItems().length === 0) {
    <!-- SKELETON -->
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
      @for (item of [1,2,3,4,5,6,7,8,9,10,11,12]; track item) {
        <div class="animate-pulse-slow bg-slate-highlight/50 rounded-lg p-4 flex flex-col items-center justify-center aspect-square">
          <div class="w-16 h-16 bg-slate-700 rounded-full mb-2"></div>
          <div class="h-4 w-24 bg-slate-700 rounded mt-2"></div>
          <div class="h-3 w-16 bg-slate-700 rounded mt-1"></div>
        </div>
      }
    </div>
  } @else if (store.error()) {
    <div class="text-center py-12 bg-red-900/50 border border-red-700 rounded-lg">
      <p class="text-xl text-red-300 mb-4">Error: {{ store.error() }}</p>
      <button (click)="retryLoad()" class="bg-neon-mint text-slate-deep font-bold py-2 px-6 rounded-lg hover:bg-opacity-80 transition-colors" aria-label="Retry loading item list">
        Retry
      </button>
    </div>
  } @else {
    <!-- ITEM GRID -->
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-4">
      @for (item of store.paginatedItems(); track item.name) {
        <a [routerLink]="['/item', item.name]" class="group bg-slate-highlight/50 border border-transparent hover:border-neon-mint/50 rounded-lg p-4 flex flex-col items-center justify-center aspect-square transition-all duration-300 transform hover:-translate-y-1 hover:shadow-2xl hover:shadow-neon-mint/10" [attr.aria-label]="'View details for ' + item.name">
          <img [src]="getItemSprite(item.name)" [alt]="item.name" class="w-16 h-16 object-contain transition-transform duration-300 group-hover:scale-125" (error)="onImageError($event)">
          <p class="mt-2 text-center font-semibold capitalize text-gray-300 group-hover:text-neon-mint transition-colors text-sm">{{ item.name.replace('-', ' ') }}</p>
          <p class="text-xs text-gray-400">Cost: {{ item.cost > 0 ? item.cost : 'N/A' }}</p>
        </a>
      } @empty {
        <div class="col-span-full text-center py-12 bg-slate-highlight/50 rounded-lg">
          <p class="text-xl text-gray-400">No items found.</p>
        </div>
      }
    </div>
    
    <!-- PAGINATION -->
    @if (store.totalPages() > 1) {
      <div class="flex justify-center items-center gap-1 sm:gap-2 mt-8 text-sm">
        <button (click)="store.goToPage(store.currentPage() - 1)" [disabled]="store.currentPage() === 1" class="px-3 py-2 bg-slate-highlight border border-slate-700 rounded-lg hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" aria-label="Go to previous page">
          &larr; Prev
        </button>
        @for(page of paginationRange(); track $index) {
          @if (page === '...') {
            <span class="px-2 sm:px-3 py-2 text-gray-400">...</span>
          } @else {
            <button (click)="store.goToPage(+page)" [class]="store.currentPage() === page ? 'bg-neon-mint text-slate-deep font-bold' : 'bg-slate-highlight border border-slate-700 hover:bg-slate-700'" class="w-10 h-10 rounded-lg transition-colors" [attr.aria-label]="'Go to page ' + page">
              {{ page }}
            </button>
          }
        }
        <button (click)="store.goToPage(store.currentPage() + 1)" [disabled]="store.currentPage() === store.totalPages()" class="px-3 py-2 bg-slate-highlight border border-slate-700 rounded-lg hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors" aria-label="Go to next page">
          Next &rarr;
        </button>
      </div>
    }
  }
</div>
